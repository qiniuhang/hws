[Unit]
After=network-online.target
Description=Hydronium Web Server
Wants=network-online.target systemd-networkd-wait-online.service

[Service]
ExecReload=/usr/bin/hws-nginx -s reload
ExecReload=/usr/bin/pkill -USR1 -x hws-caddy
ExecStart=/bin/bash -c "hws-nginx & hws-caddy -conf=/etc/hws/Caddyfile -quic &"
ExecStartPre=/usr/bin/hws-caddy -conf=/etc/hws/Caddyfile -validate
ExecStartPre=/usr/bin/hws-nginx -t
ExecStop=/usr/bin/hws-nginx -s stop
ExecStop=/usr/bin/pkill -QUIT -x hws-caddy
Restart=on-failure
Type=forking

[Exec]
AmbientCapabilities=CAP_NET_BIND_SERVICE
LimitNOFILE=8192
PrivateDevices=true
PrivateTmp=true
ProtectControlGroups=true
ProtectHome=true
ProtectKernelModules=true
ProtectKernelTunables=true
ProtectSystem=strict
ReadWritePaths=/var/cache/hws /var/lib/hws /var/log/hws
RuntimeDirectory=hws
User=http

[Install]
WantedBy=multi-user.target
